---
import "../styles/global.css";

interface Props {
    title?: string;
    description?: string;
    image?: string;
}

const {
    title = "Youssef Dhibi | Full Stack Web & Mobile Developer",
    description = "Full-stack developer building mobile and web apps from Tunisia. 17 projects, 5-star reviews, reliable and collaborative. I deliver clean, efficient code.",
    image = "/og-img.png",
} = Astro.props;

const siteUrl = "https://dhibi.tn";
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/favicons/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicons/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicons/favicon-16x16.png"
        />
        <link rel="manifest" href="/favicons/site.webmanifest" />
        <link rel="shortcut icon" href="/favicons/favicon.ico" />

        <!-- Canonical URL -->
        <link
            rel="canonical"
            href={new URL(Astro.url.pathname, siteUrl).href}
        />

        <!-- SEO Meta Tags -->
        <title>{title}</title>
        <meta name="description" content={description} />
        <meta name="author" content="Youssef Dhibi" />
        <meta name="robots" content="index, follow" />

        <!-- Open Graph -->
        <meta property="og:type" content="website" />
        <meta
            property="og:url"
            content={new URL(Astro.url.pathname, siteUrl).href}
        />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:site_name" content="Youssef Dhibi" />
        <meta property="og:image" content={new URL(image, siteUrl).href} />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:image:alt" content={title} />

        <!-- Theme Color -->
        <meta name="theme-color" content="#000000" />

        <meta name="generator" content={Astro.generator} />

        <!-- JSON-LD Structured Data -->
        <script
            type="application/ld+json"
            is:inline
            set:html={JSON.stringify({
                "@context": "https://schema.org",
                "@graph": [
                    {
                        "@type": "WebSite",
                        name: "Youssef Dhibi",
                        url: siteUrl,
                        description: description,
                        image: new URL(image, siteUrl).href,
                    },
                    {
                        "@type": "Person",
                        name: "Youssef Dhibi",
                        url: siteUrl,
                        jobTitle: "Software Engineer",
                        image: new URL(image, siteUrl).href,
                        sameAs: [
                            "https://github.com/youssefsz",
                            "https://www.linkedin.com/in/youssefsz",
                            "https://www.facebook.com/youssefszz",
                            "https://apps.apple.com/us/developer/youssef-dhibi/id1855868676",
                            "https://www.upwork.com/freelancers/youssefsz",
                        ],
                    },
                ],
            })}
        />

        <script type="text/javascript" is:inline>
            (function (c, l, a, r, i, t, y) {
                c[a] =
                    c[a] ||
                    function () {
                        (c[a].q = c[a].q || []).push(arguments);
                    };
                t = l.createElement(r);
                t.async = 1;
                t.src = "https://www.clarity.ms/tag/" + i;
                y = l.getElementsByTagName(r)[0];
                y.parentNode.insertBefore(t, y);
            })(window, document, "clarity", "script", "vlupxw8oox");
        </script>
    </head>
    <body class="min-h-screen" style="overflow: hidden;">
        <!-- Loading Overlay -->
        <div
            id="loading-overlay"
            class="fixed inset-0 z-[9999] bg-black flex flex-col items-center justify-center gap-4 transition-opacity duration-500"
        >
            <div
                class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-white mb-4"
            >
            </div>

            <div
                class="font-mono text-white/70 text-sm tracking-wider"
                id="loading-text"
            >
                >_ INITIALIZING...
            </div>

            <div
                class="w-48 h-[2px] bg-white/10 rounded-full overflow-hidden relative"
            >
                <div
                    class="absolute inset-y-0 left-0 bg-white/50 animate-[loading-bar_1.5s_ease-in-out_infinite] w-1/2"
                >
                </div>
            </div>
        </div>

        <slot />

        <script is:inline>
            // Loading text animation
            const loadingText = document.getElementById("loading-text");
            const messages = [
                ">_ INITIALIZING...",
                ">_ COMPILING ASSETS...",
                ">_ OPTIMIZING...",
            ];
            let messageIndex = 0;

            const textInterval = setInterval(() => {
                if (loadingText) {
                    if (messageIndex < messages.length - 1) {
                        messageIndex++;
                        loadingText.innerText = messages[messageIndex];
                    } else {
                        clearInterval(textInterval);
                    }
                }
            }, 800);

            // Hide loading overlay when window is fully loaded
            function hideOverlay() {
                const overlay = document.getElementById("loading-overlay");
                if (overlay) {
                    clearInterval(textInterval);
                    if (loadingText)
                        loadingText.innerText = ">_ ACCESS GRANTED";

                    setTimeout(() => {
                        overlay.style.opacity = "0";
                        setTimeout(() => {
                            overlay.style.display = "none";
                            document.body.style.overflow = "";
                        }, 500);
                    }, 500);
                }
            }

            if (document.readyState === "complete") {
                // Add a small delay if page loads instantly to show the effect
                setTimeout(hideOverlay, 800);
            } else {
                window.addEventListener("load", hideOverlay);
            }
        </script>

        <style>
            @keyframes loading-bar {
                0% {
                    left: -50%;
                }
                100% {
                    left: 100%;
                }
            }
        </style>

        <!-- Fallback for no-js -->
        <noscript>
            <style>
                #loading-overlay {
                    display: none;
                }
                body {
                    overflow: auto !important;
                }
            </style>
        </noscript>
    </body>
</html>
